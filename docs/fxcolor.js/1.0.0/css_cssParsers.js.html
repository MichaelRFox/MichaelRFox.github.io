<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>css/cssParsers.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <input type="text" id="nav-search" placeholder="Search" />
    
    <h2><a href="index.html">Home</a></h2><h2><a href="https://github.com/MichaelRFox/fxColor" target="_blank" class="menu-item" id="source_link" >Source Code</a></h2><h3>Classes</h3><ul><li><a href="Color.html">Color</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Color.html#colorSpace">colorSpace</a></li><li data-type='method' style='display: none;'><a href="Color.html#observer">observer</a></li><li data-type='method' style='display: none;'><a href="Color.html#alpha">alpha</a></li><li data-type='method' style='display: none;'><a href="Color.html#CMYK">CMYK</a></li><li data-type='method' style='display: none;'><a href="Color.html#CSScolor">CSScolor</a></li><li data-type='method' style='display: none;'><a href="Color.html#HEX">HEX</a></li><li data-type='method' style='display: none;'><a href="Color.html#HSL">HSL</a></li><li data-type='method' style='display: none;'><a href="Color.html#HSV">HSV</a></li><li data-type='method' style='display: none;'><a href="Color.html#HWB">HWB</a></li><li data-type='method' style='display: none;'><a href="Color.html#LAB">LAB</a></li><li data-type='method' style='display: none;'><a href="Color.html#LCHab">LCHab</a></li><li data-type='method' style='display: none;'><a href="Color.html#LUV">LUV</a></li><li data-type='method' style='display: none;'><a href="Color.html#LCHuv">LCHuv</a></li><li data-type='method' style='display: none;'><a href="Color.html#RGB">RGB</a></li><li data-type='method' style='display: none;'><a href="Color.html#RGBint">RGBint</a></li><li data-type='method' style='display: none;'><a href="Color.html#w3cColor">w3cColor</a></li><li data-type='method' style='display: none;'><a href="Color.html#XYZ">XYZ</a></li><li data-type='method' style='display: none;'><a href="Color.html#darken">darken</a></li><li data-type='method' style='display: none;'><a href="Color.html#lighten">lighten</a></li><li data-type='method' style='display: none;'><a href="Color.html#saturate">saturate</a></li><li data-type='method' style='display: none;'><a href="Color.html#desaturate">desaturate</a></li><li data-type='method' style='display: none;'><a href="Color.html#contrastText">contrastText</a></li></ul></li><li><a href="colorRampD.html">colorRampD</a></li></ul><h3>Modules</h3><ul><li><a href="module-alpha.html">alpha</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-alpha.html#.alpha">alpha</a></li></ul></li><li><a href="module-cmyk.html">cmyk</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-cmyk.html#.CMYK">CMYK</a></li></ul></li><li><a href="module-contrastText.html">contrastText</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-contrastText.html#~contrastTextOLD">contrastTextOLD</a></li><li data-type='method' style='display: none;'><a href="module-contrastText.html#~contrastText">contrastText</a></li></ul></li><li><a href="module-rgbColorSpace.html">rgbColorSpace</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-rgbColorSpace.html#~colorSpace">colorSpace</a></li><li data-type='method' style='display: none;'><a href="module-rgbColorSpace.html#~observer">observer</a></li></ul></li><li><a href="module-validate.html">validate</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-validate.html#~validateColorSpace">validateColorSpace</a></li><li data-type='method' style='display: none;'><a href="module-validate.html#~arrayEqual">arrayEqual</a></li><li data-type='method' style='display: none;'><a href="module-validate.html#~validate">validate</a></li></ul></li></ul><h3>Global</h3><ul><li><a href="global.html#HSLtoRGB">HSLtoRGB</a></li><li><a href="global.html#HWBtoRGB">HWBtoRGB</a></li><li><a href="global.html#RGBtoHWB">RGBtoHWB</a></li><li><a href="global.html#RGBtoLuminance">RGBtoLuminance</a></li><li><a href="global.html#parseColor">parseColor</a></li><li><a href="global.html#parsePercent">parsePercent</a></li><li><a href="global.html#CSScolor">CSScolor</a></li><li><a href="global.html#darken">darken</a></li><li><a href="global.html#desaturate">desaturate</a></li><li><a href="global.html#HEX">HEX</a></li><li><a href="global.html#HSL">HSL</a></li><li><a href="global.html#HSV">HSV</a></li><li><a href="global.html#HWB">HWB</a></li><li><a href="global.html#LAB">LAB</a></li><li><a href="global.html#LCHab">LCHab</a></li><li><a href="global.html#LCHuv">LCHuv</a></li><li><a href="global.html#lighten">lighten</a></li><li><a href="global.html#RGB">RGB</a></li><li><a href="global.html#RGBint">RGBint</a></li><li><a href="global.html#saturate">saturate</a></li><li><a href="global.html#XYZ">XYZ</a></li><li><a href="global.html#clampColor">clampColor</a></li><li><a href="global.html#illuminant">illuminant</a></li><li><a href="global.html#returnColor">returnColor</a></li><li><a href="global.html#trim">trim</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">css/cssParsers.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import {radiansToDegrees, gradsToDegrees, turnsToDegrees} from '../conversions/angleConversions.js';
import {W3CtoRGB} from '../conversions/rgbConversions.js';
import {trim} from '../utility/trim.js';

//https://www.w3.org/TR/css-color-4/

const match0to255 = '(?:255|(?:25[0-4]|2[0-4]\\d|1\\d{2}|\\d{1,2}(?:\\.\\d+)?))';
const matchPercent = '(?:100|\\d{1,2}(?:\\.\\d+)?)%';
const matchCommaOrSpace = '(?:\\s*,\\s*|\\s+)'; //
const matchCommaOrSlash = '(?:\\s+\\/\\s+|\\s*,\\s*)';
const match0to1 = '(?:1\\.0|0\\.\\d+|[01])'; // 0 to 1
const matchAlpha = `(?:${matchCommaOrSlash}(${matchPercent}|${match0to1}))?`;

const matchDeg = '(?:360|(?:3[0-5]\\d|[1-2]\\d{2}|\\d{1,2})(?:\\.\\d+)?)(?:deg)?'; //0 - 360
const matchGrad = '(?:400|(?:[1-3]\\d{2}\\.?\\d*|\\d{1,2})(?:\\.\\d+)?)grad'; // 0 to 400
const matchRad = '(?:[0-6]|[0-6]\\.\\d+)rad'; // 0 to 2 * π
const matchTurn = '(?:1\\.0|0\\.\\d+|[01])turn'; // 0 to 1

const matchHue = `${matchGrad}|${matchRad}|${matchTurn}|${matchDeg}`;

const matchCieL = '(?:400|(?:[1-3]\\d{2}|\\d{1,2})(?:\\.\\d+)?)%'; // 0 to 400%
const matchCieAB = '(?:(?:[+-])?(?:160|(?:1[0-5]\\d|\\d{1,2})(?:\\.\\d+)?))'; //+- 160
const matchCieC = '(?:230|(?:2[0-2][0-9]|1\\d{2}|\\d{1,2})(?:\\.\\d+)?)'; // 0 - 230

function parseComponents (input, regex, type) {

    const result = [... input.matchAll(regex)];
    if (result.length == 0) {
      console.error(`The input, ${input} is not a valid CSS specification for ${type}`);
      return;  
    };
    
    const qualifiers = ['%', 'deg', 'grad', 'rad', 'turn'];
    const components = result[0].slice(1).filter(d => d != undefined);
    return components.map((component, i) => {
        let numComponent;
        const index = qualifiers.findIndex(d => component.includes(d));
        if (type == 'HEX') {
            component = component.length == 1 ? component + component : component;
            numComponent = parseInt(component, 16); //component.toUpperCase();
        } else {
            numComponent = parseFloat(component);
        };

        switch (index) {
            case -1 :
                return numComponent;
            case 0:
                return type == 'RGB' &amp;&amp; i &lt; 3 ? trim(numComponent * 2.55) : trim(numComponent / 100);
            case 1:
                return numComponent;
            case 2:
                return gradsToDegrees(numComponent);
            case 3:
                if (numComponent > 2 * Math.PI) {
                    console.error(`The radians specification, ${component} exceeds 2π. The value has been clamped to 2π`);
                    return 360;
                };
                return radiansToDegrees(numComponent);
            case 4:
                return turnsToDegrees(numComponent);
        };
    });
}

function buildColorObject(components, keys) {

    if (components == undefined) return;

    let ret = {};
    components.forEach((d, i) => {
        ret[keys[i]] = d;
    });

    return ret;
}

export function parseRgb (rgb) {

    const element = `(${matchPercent}|${match0to255})`;
    const tripple = `${element}${matchCommaOrSpace}${element}${matchCommaOrSpace}${element}${matchAlpha}`;
    const matchRgb = `^rgba?\\(\\s*${tripple}\\s*\\)$`
    const regex = new RegExp(matchRgb, 'ig');
    
    return buildColorObject(parseComponents(rgb, regex, 'RGB'), ['r', 'g', 'b', 'alpha']);
}

export function parseHex (hex) {

    const matchHexSingle = '([0-9a-f])([0-9a-f])([0-9a-f])([0-9a-f])?';
    const matchHexDouble = '([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])?';
    const match = `^(?:#)(?:(?:${matchHexSingle})|(?:${matchHexDouble}))$`;
    const regex = new RegExp(match, 'ig');

    let components = parseComponents(hex, regex, 'HEX');
    if (components != undefined &amp;&amp; components.length == 4) {
        components[3] = trim(components[3] / 255);
    };

    return buildColorObject(components, ['r', 'g', 'b', 'alpha']);
}

export function parseCmyk (cmyk) {

    const element = `(${matchPercent}|${match0to1})`;
    const matchCmyk = `^(?:cmyk)\\(\\s*${element}${matchCommaOrSpace}${element}${matchCommaOrSpace}${element}${matchCommaOrSpace}${element}${matchAlpha}\\s*\\)$`;
    const regex = new RegExp(matchCmyk, 'ig');

    return buildColorObject(parseComponents(cmyk, regex, 'CMYK'), ['c', 'm', 'y', 'k', 'alpha']);

}

export function parseHsl (hsl) {
    const matchHsl = `^(?:hsla?)\\(\\s*(${matchHue})${matchCommaOrSpace}(${matchPercent})${matchCommaOrSpace}(${matchPercent})${matchAlpha}\\s*\\)$`;
    const regex = new RegExp(matchHsl, 'ig');
    
    return buildColorObject(parseComponents(hsl, regex, 'HSL'), ['h', 's', 'l', 'alpha']);
}

export function parseHsv (hsv) {
    const matchHsv = `^(?:hsva?)\\(\\s*(${matchHue})${matchCommaOrSpace}(${matchPercent})${matchCommaOrSpace}(${matchPercent})${matchAlpha}\\s*\\)$`;
    const regex = new RegExp(matchHsv, 'ig');
    
    return buildColorObject(parseComponents(hsv, regex, 'HSV'), ['h', 's', 'v', 'alpha']);
}

export function parseHwb (hwb) {
    const matchHwb = `^(?:hwb)\\(\\s*(${matchHue})${matchCommaOrSpace}(${matchPercent})${matchCommaOrSpace}(${matchPercent})${matchAlpha}\\s*\\)$`;
    const regex = new RegExp(matchHwb, 'ig');

    return buildColorObject(parseComponents(hwb, regex, 'HWB'), ['h', 'w', 'b', 'alpha']);
}

export function parseLab (lab) {
    const matchLab = `^(?:lab)\\(\\s*(${matchCieL})${matchCommaOrSpace}(${matchCieAB})${matchCommaOrSpace}(${matchCieAB})${matchAlpha}\\s*\\)$`;
    const regex = new RegExp(matchLab, 'ig');

    return buildColorObject(parseComponents(lab, regex, 'LAB'), ['l', 'a', 'b', 'alpha']);
}

export function parseLch (lch) {
    const matchLch = `^(?:lch)\\(\\s*(${matchCieL})${matchCommaOrSpace}(${matchCieC})${matchCommaOrSpace}(${matchHue})${matchAlpha}\\s*\\)$`;
    const regex = new RegExp(matchLch, 'ig');

    return buildColorObject(parseComponents(lch, regex, 'LCH'), ['l', 'c', 'h', 'alpha']);
}

export function parseLuv (luv) {
    const matchLuv = `^(?:luv)\\(\\s*(${matchPercent})${matchCommaOrSpace}((?:[+-]?)${matchPercent})${matchCommaOrSpace}((?:[+-]?)${matchPercent})${matchAlpha}\\s*\\)$`;
    const regex = new RegExp(matchLuv, 'ig');

    return buildColorObject(parseComponents(luv, regex, 'LUV'), ['l', 'u', 'v', 'alpha']);
}

/**
 * @function parseColor
 * @desc Takes  any valid CSS color specification (rgb, rgba, hex, hexa, hsl, hsla, hwb, lab, lch)
 * and parses out the component vaues.
 * @param {string} css A valid CSS color specification.
 * @returns {(Object | undefined)} An object containing key/value pairs for the type of color
 * ['rgb' | 'rgba' |'hex' | 'hexa' | 'hsl' | 'hsla' | 'hwb' | 'lab' | 'lch'] and an array of the
 * CSS color component values. If the input CSS color is invalid,
 * an error is logged to the console and undefined is returned.
 */
export function parseColor (color) {

    const regex = /^#|^rgb|^hsl|^hsv|^cmyk|^hwb|^lab|^lch|^luv/i;

    const type = color.match(regex);
    if (type == null) {
        const rgb = W3CtoRGB(color);
        console.log(rgb)
        if (rgb == undefined) {
            console.error(`The input CSS color, ${color}, is not a valid CSS color specification.`);
        } else {
            return rgb;
        };
    } else {
        switch (type[0]) {
            case 'rgb': return parseRgb(color);
            case '#': return parseHex(color);
            case 'hsl': return parseHsl(color);
            case 'hsv': return parseHsv(color);
            case 'cmyk': return parseCmyk(color);
            case 'hwb': return parseHwb(color);
            case 'lab': return parseLab(color);
            case 'lch': return parseLch(color);
            case 'luv': return parseLuv(color);
        };
    };
}

/**
 * @function parsePercent
 * @desc Parses a numberical or string percentage value and returns the decimal equivalent.
 * @param {(Number | String)} percent A percentage represented as a string (e.g., 50%) or
 * a number (e.g., 0.5). If a number above 1 is passed it is normalized in the range [0..1].
 * @returns {Number} A number in the range [0..1].
 */
export function parsePercent (percent) {

    if (typeof percent == 'string') return trim(parseInt(percent, 10) / 100);
    return percent > 1 ? trim(percent / 100) : percent; 
}</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.7</a> on Fri Nov 26 2021 10:26:20 GMT-0500 (Eastern Standard Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>

<script src="scripts/search.js" defer></script>


<script src="scripts/collapse.js" defer></script>


</body>
</html>
