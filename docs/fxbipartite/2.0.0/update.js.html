<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>update.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <input type="text" id="nav-search" placeholder="Search" />
    
    <h2><a href="index.html">Home</a></h2><h2><a href="https://github.com/MichaelRFox/fxBiPartite" target="_blank" class="menu-item" id="source_link" >Source Code</a></h2><h3>Classes</h3><ul><li><a href="biPartite.html">biPartite</a><ul class='methods'><li data-type='method' style='display: none;'><a href="biPartite.html#data">data</a></li><li data-type='method' style='display: none;'><a href="biPartite.html#container">container</a></li><li data-type='method' style='display: none;'><a href="biPartite.html#show">show</a></li><li data-type='method' style='display: none;'><a href="biPartite.html#update">update</a></li><li data-type='method' style='display: none;'><a href="biPartite.html#orient">orient</a></li><li data-type='method' style='display: none;'><a href="biPartite.html#event">event</a></li><li data-type='method' style='display: none;'><a href="biPartite.html#sort">sort</a></li><li data-type='method' style='display: none;'><a href="biPartite.html#edgeMode">edgeMode</a></li><li data-type='method' style='display: none;'><a href="biPartite.html#edgeOpacity">edgeOpacity</a></li><li data-type='method' style='display: none;'><a href="biPartite.html#fillColors">fillColors</a></li><li data-type='method' style='display: none;'><a href="biPartite.html#lightTextColor">lightTextColor</a></li><li data-type='method' style='display: none;'><a href="biPartite.html#darkTextColor">darkTextColor</a></li><li data-type='method' style='display: none;'><a href="biPartite.html#pad">pad</a></li><li data-type='method' style='display: none;'><a href="biPartite.html#duration">duration</a></li></ul></li></ul><h3>Modules</h3><ul><li><a href="module-bpMap.html">bpMap</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-bpMap.html#~bpMap">bpMap</a></li></ul></li><li><a href="module-calculate.html">calculate</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-calculate.html#~bars">bars</a></li><li data-type='method' style='display: none;'><a href="module-calculate.html#~calculateMainBars">calculateMainBars</a></li><li data-type='method' style='display: none;'><a href="module-calculate.html#~calculateSubBars">calculateSubBars</a></li><li data-type='method' style='display: none;'><a href="module-calculate.html#~calculateEdges">calculateEdges</a></li><li data-type='method' style='display: none;'><a href="module-calculate.html#~edgeVert">edgeVert</a></li><li data-type='method' style='display: none;'><a href="module-calculate.html#~edgeHoriz">edgeHoriz</a></li></ul></li><li><a href="module-color.html">color</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-color.html#~splitRgb">splitRgb</a></li><li data-type='method' style='display: none;'><a href="module-color.html#~hexToRgb">hexToRgb</a></li><li data-type='method' style='display: none;'><a href="module-color.html#~parseColor">parseColor</a></li><li data-type='method' style='display: none;'><a href="module-color.html#~textColor">textColor</a></li><li data-type='method' style='display: none;'><a href="module-color.html#~luminance">luminance</a></li><li data-type='method' style='display: none;'><a href="module-color.html#~contrast">contrast</a></li><li data-type='method' style='display: none;'><a href="module-color.html#~fill">fill</a></li><li data-type='method' style='display: none;'><a href="module-color.html#~subBarColors">subBarColors</a></li></ul></li><li><a href="module-container.html">container</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-container.html#~startListener">startListener</a></li><li data-type='method' style='display: none;'><a href="module-container.html#~stopListener">stopListener</a></li></ul></li><li><a href="module-font.html">font</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-font.html#~getFont">getFont</a></li></ul></li><li><a href="module-globals.html">globals</a></li><li><a href="module-init.html">init</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-init.html#~init">init</a></li></ul></li><li><a href="module-mouse.html">mouse</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-mouse.html#~interact">interact</a></li></ul></li><li><a href="module-simplexProblem.html">simplexProblem</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-simplexProblem.html#~buildSimplexProblem">buildSimplexProblem</a></li></ul></li><li><a href="module-sort.html">sort</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-sort.html#~sortKeys">sortKeys</a></li><li data-type='method' style='display: none;'><a href="module-sort.html#~sortAlpha">sortAlpha</a></li><li data-type='method' style='display: none;'><a href="module-sort.html#~sortBaryCentric">sortBaryCentric</a></li><li data-type='method' style='display: none;'><a href="module-sort.html#~sortSH">sortSH</a></li><li data-type='method' style='display: none;'><a href="module-sort.html#~adjacencyGraph">adjacencyGraph</a></li><li data-type='method' style='display: none;'><a href="module-sort.html#~graphPairs">graphPairs</a></li><li data-type='method' style='display: none;'><a href="module-sort.html#~edgeCrossings">edgeCrossings</a></li></ul></li><li><a href="module-text.html">text</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-text.html#~textDimensions">textDimensions</a></li><li data-type='method' style='display: none;'><a href="module-text.html#~getLabelLengths">getLabelLengths</a></li></ul></li><li><a href="module-transitions.html">transitions</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-transitions.html#~getTransitions">getTransitions</a></li></ul></li><li><a href="module-update.html">update</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-update.html#~update">update</a></li></ul></li><li><a href="module-utilities.html">utilities</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-utilities.html#~insertPseudoDiv">insertPseudoDiv</a></li><li data-type='method' style='display: none;'><a href="module-utilities.html#~checkCSS">checkCSS</a></li><li data-type='method' style='display: none;'><a href="module-utilities.html#~formatPercent">formatPercent</a></li><li data-type='method' style='display: none;'><a href="module-utilities.html#~overlap">overlap</a></li><li data-type='method' style='display: none;'><a href="module-utilities.html#~getMargins">getMargins</a></li><li data-type='method' style='display: none;'><a href="module-utilities.html#~graphSize">graphSize</a></li><li data-type='method' style='display: none;'><a href="module-utilities.html#~collapsePath">collapsePath</a></li><li data-type='method' style='display: none;'><a href="module-utilities.html#~initArray">initArray</a></li><li data-type='method' style='display: none;'><a href="module-utilities.html#~getKeys">getKeys</a></li><li data-type='method' style='display: none;'><a href="module-utilities.html#~keyPrimary">keyPrimary</a></li><li data-type='method' style='display: none;'><a href="module-utilities.html#~keySecondary">keySecondary</a></li><li data-type='method' style='display: none;'><a href="module-utilities.html#~value">value</a></li><li data-type='method' style='display: none;'><a href="module-utilities.html#~fx">fx</a></li><li data-type='method' style='display: none;'><a href="module-utilities.html#~fy">fy</a></li><li data-type='method' style='display: none;'><a href="module-utilities.html#~fw">fw</a></li><li data-type='method' style='display: none;'><a href="module-utilities.html#~fh">fh</a></li></ul></li></ul><h3>Events</h3><ul><li><a href="module-container.html#~event:containerListener">containerListener</a></li><li><a href="module-mouse.html#~event:click">click</a></li><li><a href="module-mouse.html#~event:mouseOver">mouseOver</a></li><li><a href="module-mouse.html#~event:mouseOut">mouseOut</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">update.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @module update
 * @desc Provides a function to update the DOM with the current bars, sub bars, and edges computations.
 */

import {default as d3} from './d3Build';
import {formatPercent, fx, fy, fh, fw, collapsePath} from './utilities';
import {interpolatePath} from 'd3-interpolate-path';
import {getTransitions} from './transitions';
import {default as glb} from './globals';
import {textColor, fill, subBarColors} from './color';
import {getFont} from './font';

/**
 * @function update
 * @desc Takes the computed positions of the graph elements and updates the DOM as appropriate.
 * @param {Array} bars An array of objects containing key/value pairs for the height (number), width (number),
 * x (number), y (number), value (number), percent (number), key (string), and part (string) for each bar and sub bar.
 * @param {boolean} noDelay Whether to use transitions during the update. This is set to true during container size changes.
 */
export function update (bars, noDelay = false) {
    let [t, t1, t2] = noDelay == true ? getTransitions(0, 'update') : getTransitions(glb.graph.duration(), 'update');

    let subBars = d3.select('#biPartite-subBar')
        .selectAll('.biPartite-subBar')
            .data(bars.subBars);

    subBars.enter()
        .append('g')
            .attr('class', 'biPartite-subBar')
            .attr('transform', d => `translate(${d.x}, ${d.y})`)
            .append('rect')
                .style('fill', d => fill(d))
                .style('shape-rendering', 'crispEdges')
                .transition(t)
                    .attr('x', fx)
                    .attr('y', fy)
                    .attr('width', fw)
                    .attr('height', fh);

    subBars.exit()
        .transition(t)
            .on('start', (d, i, nodes) => {
                d3.select(nodes[i]).remove();
            });

    subBars
        .transition(t)
        .attr('transform', d => `translate(${d.x}, ${d.y})`)
        .select('rect')
            .style('fill', d => fill(d))
            .attr('x', fx)
            .attr('y', fy)
            .attr('width', fw)
            .attr('height', fh);

    let edges = d3.select('#biPartite-edge')
        .selectAll('.biPartite-edge')
        .data(bars.edges);
  
    edges.enter()
        .append('path')
        // .merge(edges)
        .attr('class','biPartite-edge')
        .style('fill', d => fill(d))
        .style('fill-opacity', glb.graph.edgeOpacity())
        .attr('d', d => collapsePath(d.path))
        .transition(t)
            .attrTween('d', (d, i, nodes) => {
                return interpolatePath(d3.select(nodes[i]).attr('d'), d.path);                
            });

    edges.exit()
        .transition(t)
            .on('start', (d, i, nodes) => {
                d3.select(nodes[i]).remove();
            });

    edges
        .transition(t)
            .style('fill', d => fill(d))
            .attrTween('d', (d, i, nodes) => {
                return interpolatePath(d3.select(nodes[i]).attr('d'), d.path);                
            });

    let mainBars = d3.select('#biPartite-mainBar')
        .selectAll('.biPartite-mainBar')
        .data(bars.mainBars)
       
    let mainBarsEnter = mainBars.enter()
        .append('g')
            .attr('transform', d => `translate(${d.x}, ${d.y})`)
            .attr('class','biPartite-mainBar')
            .on(glb.eventTypeOver, glb.eventListenerOver)
            .on(glb.eventTypeOut, glb.eventListenerOut);

    mainBarsEnter
        .append('rect')
            .attr('id', (d, i) => `mainBar${i}`)
            .attr('x', fx)
            .attr('y', fy)
            .attr('width', fw)
            .attr('height', fh)
            .style('fill-opacity', 0);

    mainBarsEnter
        .append('text')
            .attr('class','biPartite-label')
            .attr('x', d => (d.part == 'primary'? -glb.LabelOffset : glb.LabelOffset))
            .attr('dy', '0.35em')
            .style('opacity', 0)
            .style('fill', glb.labelColor)
            .style('user-select', 'none')
            .text(d => d.key)
                .attr('text-anchor', d => (d.part == 'primary' ? 'end': 'start'))
                .attr('transform', d => glb.graph.orient() == 'vertical' ? 'rotate(0)' : 'rotate(90)')
                .transition(t)
                    .style('opacity', 1);

    mainBarsEnter.each ((d, i) => {
            d3.select('#percentBlackG')
                .append('g')
                    .attr('id', `percentBlack${i}`)
                    .attr('transform', `translate(${d.x}, ${d.y})`)
                    .append('text')
                        .attr('class', 'biPartite-percentage black')
                        .attr('dy', '0.35em')
                        .style('fill', glb.labelColor)
                        .style('opacity', 0)
                        .style('pointer-events', 'none')
                        .style('user-select', 'none')
                        .style('font', getFont('biPartite-percentage'))
                        .text(formatPercent(d.percent))
                            .attr('transform', glb.graph.orient() == 'vertical' ? 'rotate(0)' : 'rotate(90)')
                            .attr('text-anchor', 'middle')
                            .transition(t)
                                .style('opacity', 1);
    });

    mainBarsEnter
        .append('text')
            .attr('class', 'biPartite-percentage white')
            .attr('dy', '0.35em')
            .style('font', getFont('biPartite-percentage'))
            .style('opacity', 0)
            .style('fill', d => {
                if (d.part == 'primary') {
                    return textColor([fill(d)]);            
                } else {
                    return textColor(subBarColors(bars.subBars, d));
                };
            })
            .style('pointer-events', 'none')
            .style('user-select', 'none')
            .style('clip-path', (d, i) => `url(#clip${i})`)
            .text(function(d){ return formatPercent(d.percent)})
                .attr('transform', d => glb.graph.orient() == 'vertical' ? 'rotate(0)' : 'rotate(90)')
                .attr('text-anchor', 'middle')
                .transition(t)
                    .style('opacity', 1);

    mainBars.each ((d, i) => {
            d3.select(`#percentBlack${i}`)
                .attr('transform', `translate(${d.x}, ${d.y})`)
                .select('text')
                    .text(formatPercent(d.percent));
    });

    mainBars
        .attr('transform', d => `translate(${d.x}, ${d.y})`)
        .select('rect')
            .attr('x', fx)
            .attr('y', fy)
            .attr('width', fw)
            .attr('height', fh);

    mainBars
        .select('.biPartite-label')
            .transition(t1)
                .style('opacity', 0)
            .transition(t2)
                .attr('x', d => d.part == 'primary'? -glb.LabelOffset : glb.LabelOffset)
                .attr('text-anchor', d => (d.part == 'primary' ? 'end': 'start'))
                .text(d => d.key)
                .style('opacity', 1);

    mainBars
        .select('.biPartite-percentage.white')
            .text(d => formatPercent(d.percent));

    mainBarsEnter.each ((d, i) => {
            d3.select('#svg').select('defs')
                .append('clipPath')
                    .attr('id', `clip${i}`)
                    .append('use')
                        .attr('xlink:href', `#mainBar${i}`);
    });

    mainBars.exit()
        .transition(t)
            .on('start', (d, i, nodes) => {
                d3.select(nodes[i]).remove()
            });

    mainBars.exit().each ((d, i) => {
            d3.select(`#clip${i}`)
                .remove();
            d3.select(`#percentBlack${i}`)
                .remove();
    });

 }

</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.7</a> on Mon Nov 08 2021 14:56:28 GMT-0500 (Eastern Standard Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>

<script src="scripts/search.js" defer></script>


<script src="scripts/collapse.js" defer></script>


</body>
</html>
